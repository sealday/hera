# 赫拉后台架构

## 技术选型

- node
- typescript
- mongodb
- nestjs
- socket.io

## 模块分类

### 通用模块
- 日志
- 认证
  - JWT 认证
    - 已知问题：数据过大时出现 431 错误
  - 退出机制
- 安全 
- 权限
- 流程
- 通知
- 异常
- 误操作保障
  - 历史
  - 回收站
- 锁机制

### 业务模块

- 状态
  - 订单状态
  - 仓库状态
  - 用户状态
- 仓库
  - 计划单（无原始对应单据）
  - 流水单（包括原调拨单、购销单等），新增赔偿单
  - 服务单（维修）
  - 流水查询
  - 库存查询
- 财务
- 系统数据
  - 合同方案
    - 租价
    - 赔偿
    - 维修
  - 单价

### 其他问题

- Typegoose
使用它来解决需要同时定义 mongoose 和 interface 的问题，但是我认为定义 class 代替 mongoose 的 schema 不是很合理，很显然的一点理由是，schema 拥有更丰富的设定。实际上我认为应该反过来实践会更好。

- import 语句
需要一个自动格式化的工具，能把 imports 语句从绝对路径改成相对路径，单元测试使用绝对路径无法通过，或者 vscode 能生成相对路径也可以

- 日志处理
日志是放在 service 里面进行做，还是放在 controller 层面来做，考虑的点是在如果执行失败了，是否要记录这条查询记录（或者修改之类的记录）